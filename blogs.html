<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blogs — Shariar Imtiaz</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Header -->
  <header class="bg-indigo-600 text-white">
    <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <a href="index.html" class="bg-white text-indigo-600 px-3 py-1 rounded-lg text-sm font-semibold shadow hover:bg-slate-100">← Home</a>
        <h1 class="text-xl font-bold">Shariar’s Blog</h1>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-6 py-10">
    <!-- Filters -->
    <div class="grid md:grid-cols-[1fr,auto,auto] gap-3 items-end mb-6">
      <div>
        <label class="block text-xs text-slate-600 mb-1">Search (title or content)</label>
        <input id="q" type="text" placeholder="e.g., vector search, Oracle 23ai..."
               class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
      </div>
      <div>
        <label class="block text-xs text-slate-600 mb-1">From (date)</label>
        <input id="from" type="date"
               class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
      </div>
      <div>
        <label class="block text-xs text-slate-600 mb-1">To (date)</label>
        <input id="to" type="date"
               class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
      </div>
    </div>

    <!-- Results summary -->
    <p id="count" class="text-xs text-slate-500 mb-3"></p>

    <!-- Blog list -->
    <div id="blog-list" class="space-y-6"></div>
  </main>

  <footer class="py-10 text-center text-xs text-slate-500">
    © <span id="year"></span> Shariar Imtiaz
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // In-memory index
    let posts = []; // [{file, dateStr, date, title, content}]
    let filtered = [];

    // Utility: title from filename if no H1
    function slugToTitle(filename){
      return filename
        .replace(/^\d{4}-\d{2}-\d{2}-/,'')
        .replace(/\.md$/,'')
        .replace(/-/g,' ');
    }

    // Fetch helper
    async function fetchText(url){
      const res = await fetch(url);
      if (!res.ok) throw new Error(`${res.status} ${url}`);
      return await res.text();
    }

    // Build index: load manifest, then fetch each md for content + title
    async function buildIndex(){
      let manifest = [];
      try {
        manifest = JSON.parse(await fetchText('./blogs/index.json'));
      } catch(e) {
        console.error('Failed to load blogs/index.json', e);
        manifest = [];
      }

      // Sort newest first by filename prefix
      manifest.sort((a,b)=> b.file.localeCompare(a.file));

      const loaded = await Promise.all(manifest.map(async (item) => {
        const file = item.file;
        const m = file.match(/(\d{4}-\d{2}-\d{2})/);
        const dateStr = m ? m[1] : '1970-01-01';
        const date = new Date(dateStr);

        let md = '';
        try {
          md = await fetchText('./blogs/' + file);
        } catch(e) {
          console.warn('Failed to fetch post md:', file, e);
          return null;
        }

        const h1 = md.match(/^# (.+)/m);
        const title = (h1 ? h1[1] : slugToTitle(file)).trim();
        const content = md.toLowerCase();

        return { file, dateStr, date, title, content };
      }));

      posts = loaded.filter(Boolean);
      filtered = posts.slice();
      render();
    }

    // Apply filters from UI
    function applyFilters(){
      const q = document.getElementById('q').value.trim().toLowerCase();
      const from = document.getElementById('from').value; // YYYY-MM-DD or ''
      const to   = document.getElementById('to').value;   // YYYY-MM-DD or ''

      filtered = posts.filter(p => {
        // Text match: title OR content
        const textOk = !q || p.title.toLowerCase().includes(q) || p.content.includes(q);

        // Date range match
        let dateOk = true;
        if (from) dateOk = dateOk && (p.date >= new Date(from + 'T00:00:00'));
        if (to)   dateOk = dateOk && (p.date <= new Date(to   + 'T23:59:59'));

        return textOk && dateOk;
      });

      render();
    }

    // Render list + count
    function render(){
      const list = document.getElementById('blog-list');
      const count = document.getElementById('count');
      list.innerHTML = '';

      // Sort newest first
      const items = filtered.slice().sort((a,b)=> b.date - a.date);

      count.textContent = `${items.length} post${items.length===1?'':'s'} found`;

      items.forEach(p=>{
        const card = document.createElement('article');
        card.className = "rounded-xl border border-slate-200 bg-white p-6 shadow-sm hover:shadow-md";
        card.innerHTML = `
          <a href="blog.html?file=${encodeURIComponent(p.file)}" class="block">
            <h2 class="text-lg font-bold text-indigo-700">${p.title}</h2>
            <p class="text-xs text-slate-500">${new Date(p.dateStr).toDateString()}</p>
          </a>
        `;
        list.appendChild(card);
      });
    }

    // Wire up filters
    ['q','from','to'].forEach(id=>{
      document.getElementById(id).addEventListener('input', applyFilters);
    });

    // Init
    buildIndex();
  </script>
</body>
</html>
